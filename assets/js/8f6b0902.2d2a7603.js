"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[1187],{3905:(e,n,t)=>{t.d(n,{Zo:()=>c,kt:()=>u});var r=t(7294);function o(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function a(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?a(Object(t),!0).forEach((function(n){o(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):a(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,r,o=function(e,n){if(null==e)return{};var t,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||(o[t]=e[t]);return o}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var l=r.createContext({}),p=function(e){var n=r.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},c=function(e){var n=p(e.components);return r.createElement(l.Provider,{value:n},e.children)},d={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},m=r.forwardRef((function(e,n){var t=e.components,o=e.mdxType,a=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),m=p(t),u=o,_=m["".concat(l,".").concat(u)]||m[u]||d[u]||a;return t?r.createElement(_,i(i({ref:n},c),{},{components:t})):r.createElement(_,i({ref:n},c))}));function u(e,n){var t=arguments,o=n&&n.mdxType;if("string"==typeof e||o){var a=t.length,i=new Array(a);i[0]=m;var s={};for(var l in n)hasOwnProperty.call(n,l)&&(s[l]=n[l]);s.originalType=e,s.mdxType="string"==typeof e?e:o,i[1]=s;for(var p=2;p<a;p++)i[p]=t[p];return r.createElement.apply(null,i)}return r.createElement.apply(null,t)}m.displayName="MDXCreateElement"},6428:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>i,default:()=>d,frontMatter:()=>a,metadata:()=>s,toc:()=>p});var r=t(7462),o=(t(7294),t(3905));const a={slug:"/",sidebar_position:1,title:"Nginx \u5e38\u7528\u914d\u7f6e",data:"2023\u5e742\u670809\u65e5"},i=void 0,s={unversionedId:"docker-compose/nginx\u5e38\u7528\u914d\u7f6e",id:"docker-compose/nginx\u5e38\u7528\u914d\u7f6e",title:"Nginx \u5e38\u7528\u914d\u7f6e",description:"\u57fa\u7840\u914d\u7f6e",source:"@site/web/Docker/docker-compose/nginx\u5e38\u7528\u914d\u7f6e.md",sourceDirName:"docker-compose",slug:"/",permalink:"/Docker/",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/web/Docker/docker-compose/nginx\u5e38\u7528\u914d\u7f6e.md",tags:[],version:"current",lastUpdatedBy:"fenghang",lastUpdatedAt:1675929711,formattedLastUpdatedAt:"Feb 9, 2023",sidebarPosition:1,frontMatter:{slug:"/",sidebar_position:1,title:"Nginx \u5e38\u7528\u914d\u7f6e",data:"2023\u5e742\u670809\u65e5"},sidebar:"tutorialSidebar",previous:{title:"docker-compose\u5b9e\u73b0node\u670d\u52a1\u4ee3\u7406\u5230\u4e8c\u7ea7\u8def\u5f84",permalink:"/Docker/"}},l={},p=[{value:"\u57fa\u7840\u914d\u7f6e",id:"\u57fa\u7840\u914d\u7f6e",level:2},{value:"\u9690\u85cf Nginx \u7248\u672c\u4fe1\u606f",id:"\u9690\u85cf-nginx-\u7248\u672c\u4fe1\u606f",level:2},{value:"\u7981\u6b62ip\u76f4\u63a5\u8bbf\u95ee80\u7aef\u53e3",id:"\u7981\u6b62ip\u76f4\u63a5\u8bbf\u95ee80\u7aef\u53e3",level:2},{value:"\u542f\u52a8 web \u670d\u52a1 (vue \u9879\u76ee\u4e3a\u4f8b)",id:"\u542f\u52a8-web-\u670d\u52a1-vue-\u9879\u76ee\u4e3a\u4f8b",level:2},{value:"PC\u7aef\u548c\u79fb\u52a8\u7aef\u4f7f\u7528\u4e0d\u540c\u7684\u9879\u76ee\u6587\u4ef6\u6620\u5c04",id:"pc\u7aef\u548c\u79fb\u52a8\u7aef\u4f7f\u7528\u4e0d\u540c\u7684\u9879\u76ee\u6587\u4ef6\u6620\u5c04",level:2},{value:"\u4e00\u4e2aweb\u670d\u52a1\uff0c\u914d\u7f6e\u591a\u4e2a\u9879\u76ee (location \u5339\u914d\u8def\u7531\u533a\u522b)",id:"\u4e00\u4e2aweb\u670d\u52a1\u914d\u7f6e\u591a\u4e2a\u9879\u76ee-location-\u5339\u914d\u8def\u7531\u533a\u522b",level:2},{value:"\u914d\u7f6e\u8d1f\u8f7d\u5747\u8861",id:"\u914d\u7f6e\u8d1f\u8f7d\u5747\u8861",level:2},{value:"SSL \u914d\u7f6e HTTPS",id:"ssl-\u914d\u7f6e-https",level:2}],c={toc:p};function d(e){let{components:n,...t}=e;return(0,o.kt)("wrapper",(0,r.Z)({},c,t,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("h2",{id:"\u57fa\u7840\u914d\u7f6e"},"\u57fa\u7840\u914d\u7f6e"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-conf"},'user                            root;\nworker_processes                1;\n\nevents {\n  worker_connections            10240;\n}\n\nhttp {\n  log_format                    \'$remote_addr - $remote_user [$time_local] \' \'"$request" $status $body_bytes_sent \' \'"$http_referer" "$http_user_agent"\';\n  include                       mime.types;\n  default_type                  application/octet-stream;\n  sendfile                      on;\n  #autoindex                    on;\n  #autoindex_exact_size         off;\n  autoindex_localtime           on;\n  keepalive_timeout             65;\n  gzip                          on;\n  gzip_disable                  "msie6";\n  gzip_min_length               100;\n  gzip_buffers                  4 16k;\n  gzip_comp_level               1;\n  gzip_types                  text/plain application/x-javascript text/css application/xml text/javascript application/x-httpd-php image/jpeg image/gif image/png;\n  gzip_types                    "*";\n  gzip_vary                     off;\n  server_tokens                 off;\n  client_max_body_size          200m;\n\n  server {\n    listen                      80 default_server;\n    server_name                 _;\n    return                      403 /www/403/index.html;\n  }\n\n  include                       ../serve/*.conf;\n}\n')),(0,o.kt)("h2",{id:"\u9690\u85cf-nginx-\u7248\u672c\u4fe1\u606f"},"\u9690\u85cf Nginx \u7248\u672c\u4fe1\u606f"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-conf"},"http {\n  server_tokens         off;\n}\n")),(0,o.kt)("h2",{id:"\u7981\u6b62ip\u76f4\u63a5\u8bbf\u95ee80\u7aef\u53e3"},"\u7981\u6b62ip\u76f4\u63a5\u8bbf\u95ee80\u7aef\u53e3"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-conf"},"server {\n  listen                80 default;\n  server_name           _;\n  return                500;\n}\n")),(0,o.kt)("h2",{id:"\u542f\u52a8-web-\u670d\u52a1-vue-\u9879\u76ee\u4e3a\u4f8b"},"\u542f\u52a8 web \u670d\u52a1 (vue \u9879\u76ee\u4e3a\u4f8b)"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-conf"},"server {\n  # \u9879\u76ee\u542f\u52a8\u7aef\u53e3\n  listen            80;\n  # \u57df\u540d\uff08localhost\uff09\n  server_name       _;\n  # \u7981\u6b62 iframe \u5d4c\u5957\n  add_header        X-Frame-Options SAMEORIGIN;\n  \n  # \u8bbf\u95ee\u5730\u5740 \u6839\u8def\u5f84\u914d\u7f6e\n  location / {\n    # \u9879\u76ee\u76ee\u5f55\n    root        html;\n    # \u9ed8\u8ba4\u8bfb\u53d6\u6587\u4ef6\n    index           index.html;\n    # \u914d\u7f6e history \u6a21\u5f0f\u7684\u5237\u65b0\u7a7a\u767d\n    try_files       $uri $uri/ /index.html;\n  }\n  \n  # \u540e\u7f00\u5339\u914d\uff0c\u89e3\u51b3\u9759\u6001\u8d44\u6e90\u627e\u4e0d\u5230\u95ee\u9898\n  location ~* \\.(gif|jpg|jpeg|png|css|js|ico)$ { \n    root           html/static/;\n  }\n  \n  # \u56fe\u7247\u9632\u76d7\u94fe\n  location ~/static/.*\\.(jpg|jpeg|png|gif|webp)$ {\n    root              html;\n    valid_referers    *.deeruby.com;\n    if ($invalid_referer) {\n      return          403;\n    }\n  }\n  \n  # \u8bbf\u95ee\u9650\u5236\n  location /static {\n    root               html;\n    # allow \u5141\u8bb8\n    allow              39.xxx.xxx.xxx;\n    # deny  \u62d2\u7edd\n    deny               all;\n  }\n}\n")),(0,o.kt)("h2",{id:"pc\u7aef\u548c\u79fb\u52a8\u7aef\u4f7f\u7528\u4e0d\u540c\u7684\u9879\u76ee\u6587\u4ef6\u6620\u5c04"},"PC\u7aef\u548c\u79fb\u52a8\u7aef\u4f7f\u7528\u4e0d\u540c\u7684\u9879\u76ee\u6587\u4ef6\u6620\u5c04"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-conf"},"server {\n  ......\n  location / {\n    root /home/static/pc;\n    if ($http_user_agent ~* '(mobile|android|iphone|ipod|phone)') {\n      root /home/static/mobile;\n    }\n    index index.html;\n  }\n}\n")),(0,o.kt)("h2",{id:"\u4e00\u4e2aweb\u670d\u52a1\u914d\u7f6e\u591a\u4e2a\u9879\u76ee-location-\u5339\u914d\u8def\u7531\u533a\u522b"},"\u4e00\u4e2aweb\u670d\u52a1\uff0c\u914d\u7f6e\u591a\u4e2a\u9879\u76ee (location \u5339\u914d\u8def\u7531\u533a\u522b)"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-conf"},"server {\n  listen                80;\n  server_name           _;\n  \n  # \u4e3b\u5e94\u7528\n  location / {\n    root            html/main;\n    index               index.html;\n    try_files           $uri $uri/ /index.html;\n  }\n  \n  # \u5b50\u5e94\u7528\u4e00\n  location ^~ /store/ {\n    proxy_pass          http://localhost:8001;\n    proxy_redirect      off;\n    proxy_set_header    Host $host;\n    proxy_set_header    X-Real-IP $remote_addr;\n    proxy_set_header    X-Forwarded-For\n    proxy_set_header    X-Forwarded-For $proxy_add_x_forwarded_for;\n  }\n  \n  # \u5b50\u5e94\u7528\u4e8c\n  location ^~ /school/ {\n    proxy_pass          http://localhost:8002;\n    proxy_redirect      off;\n    proxy_set_header    Host $host;\n    proxy_set_header    X-Real-IP $remote_addr;\n    proxy_set_header    X-Forwarded-For $proxy_add_x_forwarded_for;\n  }\n  \n  # \u9759\u6001\u8d44\u6e90\u8bfb\u53d6\u4e0d\u5230\u95ee\u9898\u5904\u7406\n  rewrite ^/api/profile/(.*)$ /(\u66ff\u6362\u6210\u6b63\u786e\u8def\u5f84\u7684\u6587\u4ef6\u7684\u4e0a\u4e00\u5c42\u76ee\u5f55)/$1 last;\n}\n\n# \u5b50\u5e94\u7528\u4e00\u670d\u52a1\nserver {\n  listen                8001;\n  server_name           _;\n  location / {\n    root            html/store;\n    index               index.html;\n    try_files           $uri $uri/ /index.html;\n  }\n  \n  location ^~ /store/ {\n    alias               html/store/;\n    index               index.html index.htm;\n    try_files           $uri /store/index.html;\n  }\n  \n  # \u63a5\u53e3\u4ee3\u7406\n  location  /api {\n    proxy_pass          http://localhost:8089;\n  }\n}\n\n# \u5b50\u5e94\u7528\u4e8c\u670d\u52a1\nserver {\n  listen                8002;\n  server_name           _;\n  location / {\n    root            html/school;\n    index               index.html;\n    try_files           $uri $uri/ /index.html;\n  }\n  \n  location ^~ /school/ {\n    alias               html/school/;\n    index               index.html index.htm;\n    try_files           $uri /school/index.html;\n  }\n  \n  # \u63a5\u53e3\u4ee3\u7406\n  location  /api {\n    proxy_pass          http://localhost:10010;\n  }\n}\n")),(0,o.kt)("h2",{id:"\u914d\u7f6e\u8d1f\u8f7d\u5747\u8861"},"\u914d\u7f6e\u8d1f\u8f7d\u5747\u8861"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-conf"},"upstream my_upstream {\n  server                http://localhost:9001;\n  server                http://localhost:9002;\n  server                http://localhost:9003;\n}\n\nserver {\n  listen                9000;\n  server_name           test.com;\n\n  location / {\n    proxy_pass          my_upstream;\n    proxy_set_header    Host $proxy_host;\n    proxy_set_header    X-Real-IP $remote_addr;\n    proxy_set_header    X-Forwarded-For $proxy_add_x_forwarded_for;\n  }\n}\n")),(0,o.kt)("h2",{id:"ssl-\u914d\u7f6e-https"},"SSL \u914d\u7f6e HTTPS"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-conf"},"server {\n  listen                      80;\n  server_name                 www.xxx.com;\n  # \u5c06 http \u91cd\u5b9a\u5411\u8f6c\u79fb\u5230 https\n  return 301 https://$server_name$request_uri;\n}\n\nserver {\n  listen                      443 ssl;\n  server_name                 www.xxx.com;\n  ssl_certificate             /etc/nginx/ssl/www.xxx.com.pem;\n  ssl_certificate_key         /etc/nginx/ssl/www.xxx.com.key;\n  ssl_session_timeout         10m;\n  ssl_ciphers                 ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;\n  ssl_protocols               TLSv1 TLSv1.1 TLSv1.2;\n  ssl_prefer_server_ciphers   on;\n  \n  location / {\n    root                    /project/xxx;\n    index                   index.html index.htm index.md;\n    try_files               $uri $uri/ /index.html;\n  }\n}\n")))}d.isMDXComponent=!0}}]);